function format(e){return 10>e?"0"+e:e}function getNewWordFromList(){var e;if("easy"===gameDifficulty){do usedWords.length===wordLists.easyWordList.length&&(usedWords=[]),e=wordLists.easyWordList[Math.floor(Math.random()*wordLists.easyWordList.length)];while(-1!==usedWords.indexOf(e));usedWords.push(e)}else if("medium"===gameDifficulty){do usedWords.length===wordLists.mediumWordList.length&&(usedWords=[]),e=wordLists.mediumWordList[Math.floor(Math.random()*wordLists.mediumWordList.length)];while(-1!==usedWords.indexOf(e));usedWords.push(e)}else if("hard"===gameDifficulty){do usedWords.length===wordLists.hardWordList.length&&(usedWords=[]),e=wordLists.hardWordList[Math.floor(Math.random()*wordLists.hardWordList.length)];while(-1!==usedWords.indexOf(e));usedWords.push(e)}return e}var io=require("socket.io"),server=io.listen(3001),fs=require("fs"),gameDifficulty="hard",wordLists=JSON.parse(fs.readFileSync("server/wordLists.json")),usedWords=[],number=0,rooms={},DEBUG=!0;server.on("connection",function(e){function o(){var o=getNewWordFromList();rooms[e.accessCode].word=o,server.to(e.accessCode).emit("newWord",o)}console.log("User connected"),e.on("createRoom",function(o){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="";gameDifficulty=o;do for(var t=0;4>t;t++)r+=s.charAt(Math.floor(Math.random()*s.length));while(void 0!==rooms[r]);rooms[r]={players:{},gameStarted:!1,artist:void 0,word:"",index:0},e.emit("roomCreated",r),console.log("Created room with ID "+r)}),e.on("joinRoom",function(o,s,r){var t=rooms[o];return void 0===t?(console.log('Unknown room code "'+o+'"'),void e.emit("roomJoined",!1,'Unknown room code "'+o+'"')):t.players[s]?(console.log('Username "'+s+'" is already taken in room '+o),void e.emit("roomJoined",!1,'The username "'+s+'" is already taken')):t.gameStarted?void e.emit("roomJoined",!1,"The game has already started."):(e.join(o),t.players[s]={name:s,score:0},e.name=s,e.accessCode=o,console.log("Added player "+s+" to room "+o),e.emit("roomJoined",!0,"Success"),void server.to(o).emit("updatePlayerList",t.players))}),e.on("artistDrawDown",function(e,o,s){s=s.toUpperCase(),server.to(s).emit("artistDrawDown",e,o)}),e.on("artistDrawMove",function(e,o,s){server.to(s).emit("artistDraw",e,o)}),e.on("artistDrawStop",function(o){server.to(e.accessCode).emit("artistDrawStop")}),e.on("artistClear",function(o){server.to(e.accessCode).emit("artistClear")}),e.on("leaveRoom",function(){console.log(e.name+" disconnected from room "+e.accessCode),usedWords=[];var o=rooms[e.accessCode];if(void 0===o)return void console.log('Unknown room code "'+e.accessCode+'"');if(void 0===o.players[e.name])return void console.log('Unknown username "'+e.name+'"');o.artist&&o.artist.name===o.players[e.name]&&(console.log("Artist has left the game, picking a new one"),assignArtist()),delete o.players[e.name];var s=Object.keys(o.players);0===s.length?(console.log("Room "+e.accessCode+" has become empty, deleting it."),clearInterval(o.interval),delete rooms[e.accessCode]):server.to(e.accessCode).emit("updatePlayerList",o.players)}),e.on("startGame",function(){var s=rooms[e.accessCode];if(void 0!==s){var r=Object.keys(s.players).length;if(3>r)return void server.to(e.accessCode).emit("playersInsufficient");if(s&&!s.gameStarted){o();var t=120,a=function(){s.gameStarted=!0;var r=Object.keys(s.players).length;if(s.index>=r)return s.index=0,void server.to(e.accessCode).emit("gameEnd");for(var a=Object.keys(s.players),i=(a.length*Math.random()<<0,s.index);r>i;){if(null!==s.players[a[i]]){s.artist=s.players[a[i]];break}i++}return i>=r?(s.index=0,void server.to(e.accessCode).emit("gameEnd")):(s.index=i,console.log(s.artist.name+" is now the artist for room "+e.accessCode),server.to(e.accessCode).emit("gameStarted",t),server.to(e.accessCode).emit("artistSelected",s.artist.name),o(),void s.index++)};a(),s.time=t,s.interval=setInterval(function(){s.time--,s.time<=0&&(console.log("Assigning a new artist"),a(),s.time=t)},1e3)}}}),e.on("skippedWord",function(){rooms[e.accessCode].time-=5,server.to(e.accessCode).emit("minusTimer")}),e.on("newWord",function(){o(e.accessCode)}),e.on("clearUsedWordsList",function(){usedWords=[]}),e.on("guess",function(s){s.toLowerCase()===rooms[e.accessCode].word.toLowerCase()?(server.to(e.accessCode).emit("correctGuess",e.name,s.toLowerCase()),o(e.accessCode),rooms[e.accessCode].players[e.name].score++,rooms[e.accessCode].artist.score++,server.to(e.accessCode).emit("updatePlayerList",rooms[e.accessCode].players)):server.to(e.accessCode).emit("wrongGuess",e.name,s)})});var oldLog=console.log;console.log=function(e){if(DEBUG){var o=new Date;oldLog(format(o.getHours())+":"+format(o.getMinutes())+":"+format(o.getSeconds())+" ~ "+e)}};